<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stream</title>
</head>
<body>
    <h1>Live Camera Stream</h1>
    
    <img id="video" src="" alt="Video stream not available">
    
    <script>
        let websocket = null;
        const videoElement = document.getElementById('video');
        let imageBuffer = [];
        const setupFn = function setup() {
            if (websocket) { websocket.close(); }
            websocket = new WebSocket('ws://192.168.0.124:8765');
            websocket.binaryType = 'blob';
            websocket.onmessage = function(event) {
                imageBuffer.push(event.data);

                const blob = new Blob(imageBuffer, { type: 'image/jpeg' });
                const url = URL.createObjectURL(blob);

                videoElement.onload = () => {
                    URL.revokeObjectURL(videoElement.src);
                    imageBuffer = [];
                };
                videoElement.src = url;
            };

            websocket.onerror = function(error) {
                console.error('WebSocket error:', error);
                setTimeout(setupFn, 5000);
            };

            websocket.onclose = function() {
                console.log('WebSocket connection closed. Reconnecting...');
                setTimeout(setupFn, 5000);
            };

            setInterval(() => {
                if (websocket.readyState === WebSocket.OPEN) {
                    websocket.send('ping'); 
                }
            }, 1000);
        }
        setupFn();
    </script>
</body>
</html>
